---
title: "fireSense_FrequencyPredict"
author: "Jean Marchal"
date: "August 2016"
output:
  html_document: default
  pdf_document: default
---

# Overview
Predict fire frequencies from a model fitted using the fireSense_FrequencyFit module. These can be used to feed the ignition component of a landscape fire model (e.g fireSense).

# Download the module
```{r download module, eval = FALSE, echo = TRUE}
library(SpaDES)

moduleName <- "fireSense_FrequencyPredict"

workingDirectory <- tempdir() # Change this to a place you would like to put the model, if desired

downloadModule(moduleName, path = workingDirectory)
```

# Usage
## Module parameters
Name|Default|Description
----|-------|---------------------------------------------------------------------
f|1|numeric. Rescale predicted rates of fire counts at any given temporal and spatial resolutions by a factor f = new_res / old_res. f is the ratio between the scale of data aggregation at which the statistical model was fitted to the scale at which predictions should be made.
data|NULL|optional. A character vector indicating the names of objects in the simList environment in which to look for variables in the model. Data objects should be data.frames. If omitted, or if variables are not found in data objects, variables are searched in the simList environment.
mapping|NULL|optional. Named character vector or list mapping some or all variables in the model to those in data objects.
initialRunTime|start(sim)|optional. Simulation time at which to start this module. Defaults to simulation start time.
intervalRunModule|NA|optional. Interval in simulation time units between two runs of this module.
|||

## Usage example
```{r module_usage, eval = FALSE}
library(SpaDES)
library(magrittr)
library(raster)

set.seed(1)

## Make data
df <- data.frame(
  weather2 = rnorm(1000, 150, 30),
  fireFrequency = rpois(1000, .5)
)

## Make a typical output of fireSense_FrequencyFit
fireSense_FrequencyFitted <- list(
  formula = formula(fireFrequency ~ weather),
  family = poisson(),
  coef = setNames(0.01, "weather")
)
class(fireSense_FrequencyFit) <- "fireSense_FrequencyFit"

#outputDir <- file.path(tempdir(), "outputs")
times <- list(start = 1, end = 1)
parameters <- list(
  fireSense_FrequencyFit = list(
    f = 10, # Rescale predicted rates of fire count at any given temporal and spatial resolutions by a factor f = new_res / old_res
    mapping = list(weather2 = "weather"), # One can use the mapping arg to map variable's names in the data to those in the formula of the fitted object.
                                          # Here weather (formula) is mapped to weather2 (data).
    data = "df"
  )
)

modules <- list("fireSense_FrequencyPredict")
objects <- c("df", "fireSense_FrequencyFitted") # Pass objects found in the global environment to the simList environment.
paths <- list(
  # cachePath = file.path(outputDir, "cache"),
  modulePath = file.path("~/Documents/GitHub/McIntire-lab/modulesPrivate/") ## TODO: change this to tempdir()
  # inputPath = inputDir,
  # outputPath = outputDir
)
 
mySim <- simInit(times = times, params = parameters, modules = modules, objects = objects, paths = paths)

## TODO: raster layer/stack

spades(mySim)
```

# Events
Events are scheduled as follows:

- Module initiation
- Make predictions

## Saving
TODO: Write what is saved. (there is currently nothing saved, but this may change in the future)

# Data dependencies

## Input data
- An or several objects of class data.frame in which to look for variables with which to predict.
- An object of class fireSense_FrequencyFit, i.e. created with the fireSense_FrequencyFit module.

## Output data
An object whose class depends on those in input:

Input object class | Output object class
:-:|:-:
data.frame | vector
raster | raster
||

# Links to other modules
Predictions made using this module can be used to feed the ignition component of a landscape fire model (e.g fireSense).

