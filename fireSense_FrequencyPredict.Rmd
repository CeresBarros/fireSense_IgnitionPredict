---
title: "fireSense_FrequencyPredict"
author: "Jean Marchal"
date: "August 2016"
output:
  html_document: default
  pdf_document: default
---

# Overview
Predict rates of fire frequency from a model fitted using the fireSense_FrequencyFit module. These can be used to feed the ignition component of a landscape fire model (e.g fireSense).

# Download the module
```{r download module, eval = FALSE, echo = TRUE}
library(SpaDES)

moduleName <- "fireSense_FrequencyPredict"

workingDirectory <- tempdir() # Change this to a place you would like to put the module, if desired.

downloadModule(moduleName, path = workingDirectory)
```

# Usage
## Module parameters
Name|Default|Description
----|:-------:|---------------------------------------------------------------------
`f`|`1`|`numeric`. Rescale predicted rates of fire counts at any given temporal and spatial resolutions by a factor `f = new_res / old_res`. `f` is the ratio between the scale of data aggregation at which the statistical model was fitted to the scale at which predictions should be made.
`data`|`NULL`|optional. A `character vector` indicating the names of objects in the `simList` environment in which to look for variables in the model. Data objects should be `data.frames`. If omitted, or if variables are not found in data objects, variables are searched in the `simList` environment.
`mapping`|`NULL`|optional. Named `character vector` or `list` mapping some or all variables in the model to those in data objects.
`initialRunTime`|`start(sim)`|optional. Simulation time at which to start this module. Defaults to simulation start time.
`intervalRunModule`|`NA`|optional. Interval in simulation time units between two runs of this module.
|||

## Usage example
```{r module usage example, eval = FALSE}
library(SpaDES)

# Packages required by the module
library(magrittr)
library(raster)

set.seed(1)

# Create random weather and fire frequency data
  # data.frame
  dataObject <- data.frame(
    weather = rnorm(1000, 150, 30),
    fireFrequency = rpois(1000, .5)
  )

  # raster
  nx <- ny <- 100L
  dataObject <- raster(nrows = ny, ncols = nx, xmn = -nx/2, xmx = nx/2, ymn = -ny/2, ymx = ny/2) %>%
    gaussMap(scale = 300, var = 0.03, speedup = nx/5e2, inMemory = TRUE) %>%
    list(weather = .)
  
# Create a typical output of fireSense_FrequencyFit
fireSense_FrequencyFitted <- list(
  formula = fireFrequency ~ weather2,
  family = poisson(),
  coef = setNames(c(0.1, 0.01), c("intercept", "weather2"))
)
class(fireSense_FrequencyFitted) <- "fireSense_FrequencyFit"

#outputDir <- file.path(tempdir(), "outputs")
times <- list(start = 1, end = 1, timeunit = "year")
parameters <- list(
  fireSense_FrequencyPredict = list(
    f = 10,
    mapping = list(weather2 = "weather"), # One can use mapping to map variables in the 
                                          # formula of the fitted object to those in data.
                                          # Here weather2 (formula) is mapped to weather (data).
    data = "dataObject"
  )
)

modules <- list("fireSense_FrequencyPredict")
objects <- c("dataObject", "fireSense_FrequencyFitted") # Pass objects found in the global environment to the simList environment
paths <- list(
  # cachePath = file.path(outputDir, "cache"),
  modulePath = file.path("~/Documents/GitHub/McIntire-lab/modulesPrivate/") ## TODO: change this to tempdir()
  # inputPath = inputDir,
  # outputPath = outputDir
)
 
mySim <- simInit(times = times, params = parameters, modules = modules, objects = objects, paths = paths)

spades(mySim)
```

# Events
Events are scheduled as follows:

- Module initiation
- Make predictions

## Saving
TODO: Write what is saved. (there is currently nothing saved, but this may change in the future)

# Data dependencies
## Input data
- An object of class `fireSense_FrequencyFit`, i.e. created with the fireSense_FrequencyFit module.
- An or several objects of class `data.frame` in which to look for variables with which to predict.

## Output data
An object whose class depends on those in input:

Input object class | Output object class
:-:|:-:
`data.frame` | `numeric`
`RasterLayer` | `RasterLayer`
||

# Links to other modules
Predictions made with this module can be used to feed the ignition component of a landscape fire model (e.g fireSense).

