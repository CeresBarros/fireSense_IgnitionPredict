---
title: "fireSense_FrequencyPredict"
author: "Jean Marchal"
date: "July 2017"
output:
  html_document: default
  pdf_document: default
---

# Overview
Predicts fire frequency or rates of fire counts from a model fitted using the fireSense_FrequencyFit module. These can be used to feed the ignition component of a landscape fire model (e.g fireSense).

# Download the module
```{r download module, eval = FALSE, echo = TRUE}
library(SpaDES)

moduleName <- "fireSense_FrequencyPredict"

workingDirectory <- tempdir() # Location where the module will be downloaded

downloadModule(moduleName, path = workingDirectory)
```

# Usage
## Module parameters
Name|Default|Description
----|:-------|---------------------------------------------------------------------
`f`|`1`|Rescale predicted rates of fire counts at any given temporal and spatial resolutions by a factor $f = new\_res / old\_res$. `f` is the ratio between the aggregation scale of data to which the statistical model has been fitted and the scale at which predictions are to be made.
`data`|`"dataFireSense_FrequencyPredict"`|a character vector indicating the names of objects in the `simList` environment in which to look for variables in the model. `data` objects should be data.frames or named lists of RasterLayers. If omitted, or if variables are not found in `data` objects, variables are searched in the `simList` environment.
`mapping`|`NULL`|optional named vector or list of character strings mapping one or more variables in the model formula to those in `data` objects.
`initialRunTime`|`start(simList)`|when to start this module? By default, the start time of the simulation.
`intervalRunModule`|`NA`|optional. Interval between two runs of this module, expressed in units of simulation time.
|||

## Usage example
```{r module usage example, eval = FALSE}
library(SpaDES)

# Packages required by the module
library(magrittr)
library(raster)

set.seed(1)

# Create random weather and fire frequency data
  # data.frame
  dataObject <- data.frame(
    weather = rnorm(1000, 150, 30),
    fireFrequency = rpois(1000, .5)
  )

  # raster
  nx <- ny <- 100L
  dataObject <- raster(nrows = ny, ncols = nx, xmn = -nx/2, xmx = nx/2, ymn = -ny/2, ymx = ny/2) %>%
    gaussMap(scale = 300, var = 0.03, speedup = nx/5e2, inMemory = TRUE) %>%
    list(weather = .)
  
# Create a typical output of fireSense_FrequencyFit
fireSense_FrequencyFitted <- list(
  formula = fireFrequency ~ weather2,
  family = poisson(),
  coef = setNames(c(0.1, 0.01), c("intercept", "weather2"))
)
class(fireSense_FrequencyFitted) <- "fireSense_FrequencyFit"

#outputDir <- file.path(tempdir(), "outputs")
times <- list(start = 1, end = 1, timeunit = "year")
parameters <- list(
  fireSense_FrequencyPredict = list(
    f = 10,
    mapping = list(weather2 = "weather"), # One can use mapping to map variables in the 
                                          # formula of the fitted object to those in data.
                                          # Here weather2 (formula) is mapped to weather (data).
    data = "dataObject"
  )
)

modules <- list("fireSense_FrequencyPredict")
objects <- c("dataObject", "fireSense_FrequencyFitted") # Pass objects found in the global environment to the simList environment
paths <- list(
  # cachePath = file.path(outputDir, "cache"),
  modulePath = file.path("~/Documents/GitHub/McIntire-lab/modulesPrivate/") ## TODO: change this to tempdir()
  # inputPath = inputDir,
  # outputPath = outputDir
)
 
mySim <- simInit(times = times, params = parameters, modules = modules, objects = objects, paths = paths)

spades(mySim)
```

# Events
Events are scheduled as follows:

- Module initiation
- Make predictions

## Saving
TODO: Write what is saved. (there is currently nothing saved, but this may change in the future)

# Data dependencies
## Input data
- **fireSense_FrequencyFitted**: an object of class `fireSense_FrequencyFit` created with the fireSense_FrequencyFit module.
- **dataFireSense_FrequencyPredict**: one or more data.frames or named lists of RasterLayers in which to look for variables with which to predict.

## Output data
An object whose class depends on those in input:

Input object class | Output object class
:-:|:-:
`data.frame` | `Numeric vector`
`RasterLayer` | `RasterLayer`
||

# Links to other modules
Predictions made with this module can be used to feed the ignition component of a landscape fire model (e.g fireSense).

